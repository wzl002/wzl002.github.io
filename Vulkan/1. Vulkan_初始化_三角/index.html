<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>1. Vulkan 初始化 三角 - Wesley的轨迹</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Wesley的轨迹</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">首页</a>
                            </li>
                            <li class="navitem">
                                <a href="../../GLES/Framebuffer%20Object/" class="nav-link">OpenGL(ES)</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Vulkan <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../0.1.%20Vulkan%20%E6%89%A9%E5%B1%95/" class="dropdown-item">0.1. Vulkan 扩展</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#1" class="nav-link">1. 流程总览</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#2-api" class="nav-link">2. 初始化时, 涉及的 API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#2-vulkan-objects" class="nav-link">2. 理解 Vulkan® Objects</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">对象组</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#3-pipeline" class="nav-link">3. Pipeline</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#4" class="nav-link">4. 详细</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="toc">
<ul>
<li><a href="#1">1. 流程总览</a></li>
<li><a href="#2-api">2. 初始化时, 涉及的 API</a></li>
<li><a href="#2-vulkan-objects">2. 理解 Vulkan® Objects</a><ul>
<li><a href="#1-instance">1. Instance</a></li>
<li><a href="#2-physicaldevice">2. PhysicalDevice</a></li>
<li><a href="#3-device">3. Device</a></li>
<li><a href="#4-queue">4. Queue</a></li>
<li><a href="#5-commandpool">5. CommandPool</a></li>
<li><a href="#6-commandbuffer">6. CommandBuffer</a></li>
<li><a href="#7-sampler">7. Sampler</a></li>
<li><a href="#8-image-buffer">8. Image &amp; Buffer</a></li>
<li><a href="#todo">TODO</a></li>
<li><a href="#9-devicememory">9. DeviceMemory</a></li>
</ul>
</li>
<li><a href="#_1">对象组</a><ul>
<li><a href="#_2">设备</a></li>
<li><a href="#_3">图像</a></li>
<li><a href="#_4">管道</a></li>
</ul>
</li>
<li><a href="#3-pipeline">3. Pipeline</a></li>
<li><a href="#4">4. 详细</a></li>
</ul>
</div>
<h1 id="1">1. 流程总览</h1>
<ul>
<li>初始设置</li>
<li>Instance 实例</li>
<li>[Validation Layer 校验层]</li>
<li>Physical Device &amp; Queue Family 物理设备 与 队列族</li>
<li>Device &amp; Queue 逻辑设备 与 队列</li>
<li>呈现</li>
<li>[Surface 窗口]</li>
<li>Swapchain 交换链</li>
<li>ImageView 图像视图</li>
<li>Pipeline 管道</li>
<li>Shader Modules 着色器</li>
<li>Fixed Function 固定方法</li>
<li>Renderpass 渲染流程</li>
<li>绘制</li>
<li>Framebuffers 帧缓冲</li>
<li>Commandbuffers  指令缓冲</li>
<li>Rendering and presentation 渲染与呈现<ul>
<li>Recreation Swapchain  重绘交换链</li>
</ul>
</li>
</ul>
<p>注: []: 非 Vulkan 核心</p>
<pre><code class="language-c++">init_global_layer_properties(info);
init_instance_extension_names(info);
init_device_extension_names(info);
init_instance(info, sample_title);
init_enumerate_device(info);
init_window_size(info, 500, 500);
init_connection(info);
init_window(info);
init_swapchain_extension(info);
init_device(info);

init_command_pool(info);
init_command_buffer(info);
execute_begin_command_buffer(info);
init_device_queue(info);
init_swap_chain(info);
init_depth_buffer(info);
init_uniform_buffer(info);
init_descriptor_and_pipeline_layouts(info, false);
init_renderpass(info, depthPresent);

#include &quot;15-draw_cube.vert.h&quot;
#include &quot;15-draw_cube.frag.h&quot;
VkShaderModuleCreateInfo vert_info = {};
VkShaderModuleCreateInfo frag_info = {};
vert_info.sType = frag_info.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;
vert_info.codeSize = sizeof(__draw_cube_vert);
vert_info.pCode = __draw_cube_vert;
frag_info.codeSize = sizeof(__draw_cube_frag);
frag_info.pCode = __draw_cube_frag;

init_shaders(info, &amp;vert_info, &amp;frag_info);
init_framebuffers(info, depthPresent);
init_vertex_buffer(info, g_vb_solid_face_colors_Data, sizeof(g_vb_solid_face_colors_Data), 
    sizeof(g_vb_solid_face_colors_Data[0]), false);
init_descriptor_pool(info, false);
init_descriptor_set(info, false);
init_pipeline_cache(info);
init_pipeline(info, depthPresent);
</code></pre>
<h1 id="2-api">2. 初始化时, 涉及的 API</h1>
<ul>
<li>初始设置</li>
<li>Instance 实例<ul>
<li>vkCreateInstance</li>
</ul>
</li>
<li>[Validation Layer 校验层]</li>
<li>Physical Device &amp; Queue Family 物理设备 与 队列族<ul>
<li>vkEnumeratePhysicalDevices</li>
<li>vkGetPhysicalDeviceQueueFamilyProperties</li>
</ul>
</li>
<li>Device &amp; Queue 逻辑设备 与 队列</li>
<li>呈现</li>
<li>[Surface 窗口]</li>
<li>Swapchain 交换链</li>
<li>ImageView 图像视图</li>
<li>Pipeline 管道</li>
<li>Shader Modules 着色器</li>
<li>Fixed Function 固定方法</li>
<li>Renderpass 渲染流程</li>
<li>绘制</li>
<li>Framebuffers 帧缓冲</li>
<li>Commandbuffers  指令缓冲</li>
<li>Rendering and presentation 渲染与呈现</li>
<li>Recreation Swapchain  重绘交换链</li>
</ul>
<h1 id="2-vulkan-objects">2. 理解 Vulkan® Objects</h1>
<p><img alt="" src="../img/Vulkan-Diagram.png" /></p>
<ul>
<li>
<p>绿色框: 无类型, 以 uint32_t 表示</p>
</li>
<li>
<p>实线+箭头: 创建顺序</p>
</li>
<li>
<p>实线+菱形: 组合 (被包含)</p>
</li>
<li>
<p>虚线: 通信</p>
</li>
</ul>
<p>三个区域中, 红色为主 Object, 其他对象都直接或间接的由此对象创建.  表现为 vkCreateSwapchainKHR 需要 Device 为参数.</p>
<h3 id="1-instance">1. Instance</h3>
<ul>
<li>
<p>Instance 是创建的第一个对象。</p>
</li>
<li>
<p>它表示从应用程序到 Vulkan 运行时的<strong>连接</strong>，因此在应用程序中仅应<strong>存在一次</strong>。</p>
</li>
<li>它还存储使用 Vulkan 所需的所有特定于<code>应用程序</code>的状态。</li>
<li>因此，您必须指定创建实例时要启用的所有层 <strong>Layers</strong>（例如验证层）和所有扩展 Extensions。</li>
</ul>
<h3 id="2-physicaldevice">2. PhysicalDevice</h3>
<ul>
<li>表示特定的 Vulkan 兼容设备，例如图形卡。</li>
<li><code>vkEnumeratePhysicalDevices</code> </li>
<li>您可以从 <code>Instance</code> 中<strong>枚举</strong>它们，然后可以查询它们的 vendorID，deviceID 和支持的功能以及其他属性和限制。</li>
<li><code>vkGetPhysicalDeviceQueueFamilyProperties</code></li>
<li>PhysicalDevice 可以枚举所有可用的 <strong>Queue Families</strong> 类型。</li>
<li>图形队列 <strong>Graphics Queue</strong> 是最主要的队列，但是您可能还有其他仅支持计算Compute 或传输 Transfer的队列。</li>
<li>PhysicalDevice还可以枚举其内部的内存堆 <strong>Memory Heaps</strong> 和内存类型  <strong>Memory Types</strong>。</li>
<li><strong>Memory Heaps</strong> 代表特定的RAM池。<ul>
<li>它可能会提取 主板上的系统RAM, 或专用图形卡上的视频RAM中的特定内存空间，或者实现要公开的任何其他特定于主机或设备的内存。</li>
<li>分配内存 <code>Allocate Memory</code>时必须指定 <strong>Memory Types</strong>。</li>
<li>它具有对 Memory Blob 的特定要求，例如对 host 可见，一致性 coherent（在CPU和GPU之间）和已缓存 cached。这些可能会任意组合，具体取决于设备驱动程序。</li>
</ul>
</li>
</ul>
<h3 id="3-device">3. Device</h3>
<ul>
<li>又被视为 逻辑设备 Logical Device 或 Opened Device.</li>
<li>它代表了一个已经初始化的 Vulkan 设备, 准备好创建其他对象</li>
<li>创建设备时, 需指定启用哪些 <strong>Features</strong>, 并声明所有使用的 <strong>Queue</strong>, 其编号 和其 Queue Family </li>
</ul>
<h3 id="4-queue">4. Queue</h3>
<ul>
<li>
<p>Device 上执行的命令队列 Queue of Commands。</p>
</li>
<li>
<p>通过使用 <code>vkQueueSubmit</code> 填充 <strong>CommandBuffer</strong> 并将其提交到 Queue，来请求 GPU 完成的所有实际工作。</p>
</li>
<li>如果有多个队列，例如 Graphic Queue 和 Compute Queue，则可以向每个队列提交不同的CommandBuffer。这样，您就可以启用异步计算，如果执行正确的话，可以大大提高速度。</li>
</ul>
<h3 id="5-commandpool">5. CommandPool</h3>
<ul>
<li>用于分配 <strong>CommandBuffer</strong>。它已连接到特定的 <strong>Queue Family</strong>。</li>
</ul>
<h3 id="6-commandbuffer">6. CommandBuffer</h3>
<ul>
<li>从指定的<strong>CommandPool</strong>分配。它代表 Device 要执行的各种命令的缓冲区。</li>
<li>可以在 Command Buffer 上调用各 <code>vkCmd</code> 开头的函数，用于指定 执行的任务的顺序，类型和参数。</li>
<li>之后 CommandBuffer 提交到 <strong>Queue</strong> 并最终由 <strong>Device</strong> 执行</li>
</ul>
<h3 id="7-sampler">7. Sampler</h3>
<ul>
<li>采样器 Sampler 未绑定到任何特定图像 Image。它只是一组状态参数 state parameters ，</li>
<li>例如过滤模式 (filtering mode)（最近或线性 nearest or linear）,或寻址模式 (addressing mode)（重复，钳位到边缘，钳位到边界等 repeat, clamp-to-edge, clamp-to-border）。</li>
</ul>
<h3 id="8-image-buffer">8. Image &amp; Buffer</h3>
<h3 id="todo">TODO</h3>
<ul>
<li>缓冲区和图像是占用设备内存的两种资源。 </li>
<li>缓冲区比较简单。 它是任何具有长度的二进制数据的容器,  以字节表示。 </li>
<li>另一方面，图像代表一组像素。 </li>
<li>这是其他图形API中称为纹理的对象。 </li>
<li>需要更多参数来指定图像的创建。 它可以是1D，2D或3D，具有各种像素格式（如R8G8B8A8_UNORM或R32_SFLOAT），</li>
<li>并且还可以包含许多离散图像，因为它可以具有多个阵列层或MIP级别（或两者）。 </li>
<li>图片是一种独立的对象类型，因为它不一定只包含可以直接访问的线性像素集。 </li>
<li>图像可以具有由图形驱动程序管理的不同的特定于实现的内部格式（平铺和布局）。</li>
</ul>
<h3 id="9-devicememory">9. DeviceMemory</h3>
<p>创建一定长度的缓冲区或具有特定尺寸的图像不会自动为其分配内存。 这是一个三步过程，必须由您手动执行。 您也可以选择使用我们的Vulkan内存分配器库，该库将为您分配资源。</p>
<p>1.分配DeviceMemory，
2.创建缓冲区或图像，
3.使用功能vkBindBufferMemory或vkBindImageMemory将它们绑定在一起。</p>
<p>因此，您还必须创建一个DeviceMemory对象。 它代表从特定内存类型（由PhysicalDevice支持）分配的内存块，具有特定的字节长度。 您不应该为每个缓冲区或映像分配单独的DeviceMemory。 相反，您应该分配更大的内存块，并将其中的一部分分配给缓冲区和图像。 分配是一项昂贵的操作，并且最大分配数量也受到限制，所有这些都可以从PhysicalDevice中查询。</p>
<h1 id="_1">对象组</h1>
<h4 id="_2">设备</h4>
<ul>
<li>Instance </li>
<li>PhysicalDevice<ul>
<li>Queue Family</li>
<li>Memory Heap</li>
<li>Memory Type --&gt; Device Memory</li>
</ul>
</li>
<li>Device</li>
<li>Queue &lt;-- Queue Family</li>
</ul>
<h4 id="_3">图像</h4>
<ul>
<li>Surface</li>
<li>Swapchain</li>
<li>Image</li>
<li>ImageView</li>
<li>Framebuffer  &lt;--RenderPass</li>
</ul>
<h4 id="_4">管道</h4>
<ul>
<li>
<p>DescriptorSetLayout</p>
</li>
<li>
<p>PipelineLayout</p>
</li>
<li>
<p>ShaderModule</p>
</li>
<li>
<p>Pipeline Cache</p>
</li>
<li>
<p>PipeLine</p>
</li>
</ul>
<p>DescriptorSet &lt;-- DescriptorSetLayout,  DescriptorPool</p>
<h1 id="3-pipeline">3. Pipeline</h1>
<h1 id="4">4. 详细</h1>
<ul>
<li>Instance 实例</li>
<li>[Validation Layer 校验层]</li>
<li>Physical Device &amp; Queue Family 物理设备 与 队列族</li>
<li>
<p>Device &amp; Queue 逻辑设备 与 队列</p>
</li>
<li>
<p>[Surface 窗口]</p>
</li>
<li>Swapchain 交换链</li>
<li>
<p>ImageView 图像视图</p>
</li>
<li>
<p>Pipeline 管道</p>
</li>
<li>Shader Modules 着色器</li>
<li>Fixed Function 固定方法</li>
<li>Renderpass 渲染流程</li>
<li>Framebuffers 帧缓冲</li>
<li>Commandbuffers  指令缓冲</li>
<li>Rendering and presentation 渲染与呈现</li>
<li>Recreation Swapchain  重绘交换链</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
